# 智能文书生成系统需求文档

## 1. 项目概况 (Overview)

### 1.1 背景

针对高校行政与科研场景中"格式严、流程繁、重复多"的痛点，构建一个**"合规优先、结构化生成"**的智能文书平台。

### 1.2 目标 (Scope)

- 构建一个高保真**纯前端演示平台** (Web Demo)
- **不涉及**复杂后端逻辑与真实大模型接入
- **核心任务**：通过"硬编码数据 + 状态机"模拟 AI 生成全流程，重点展示 UI 交互的专业度和公文排版的规范性

### 1.3 设计理念

- **视觉风格**：政务蓝 (`#1890FF`) + 清爽卡片 (`#FFFFFF`) + 浅灰底色 (`#F5F7FA`)
- **交互模式**：左侧垂直步骤导航 + 右侧卡片式操作区（沉浸式体验）

---

## 2. 产品定义与边界 (Product Definition)

### 2.1 核心定位

本系统并非单纯的"AI 写作工具"，而是面向高校行政与科研场景的 **"文书工厂 + 合规模板 + 流程流转 + 归档检索"** 综合平台。

**不解决**：天马行空的创意写作。

**解决**：高校公文的合规性、格式标准化、流程审批及历史追溯。

### 2.2 产品架构策略：核心+插件

采用 **"核心平台 + 场景插件"** 的可扩展架构，避免系统臃肿。

#### 核心平台 (Kernel)
提供账号、模板引擎、知识库检索、流程引擎、文档渲染服务。

#### 场景插件 (Plugins)

- **P0 (首发)**：行政公文（通知/请示/纪要）、科研材料（申报书/结题报告）
- **P1 (后续)**：教学材料（大纲/教案）、期刊编辑（审稿意见）

---

## 3. 核心业务流程：四段式生成引擎

这是本系统的核心逻辑差异点。**严禁 AI 直接生成全文**，必须强制遵循以下流水线：

### 3.1 结构规划 (Structure)

基于场景生成/选择大纲（一级/二级标题），人工确认逻辑骨架。

### 3.2 证据装配 (Evidence)

RAG 引擎从知识库（制度/历史文书）中检索条款，挂载到对应段落作为"生成依据"。

### 3.3 段落生成 (Generation)

LLM 基于"当前段落意图 + 挂载依据 + 用户输入"逐段生成内容。

### 3.4 格式编排 (Formatting)

将内容注入结构化对象，套用红头/版式，生成最终文档。

---

## 4. 功能需求详解 (Functional Requirements)

### 4.1 核心平台功能

#### 4.1.1 模板中心 (Template Center)

**红头管理**：
- 支持上传 `.doc`/`.wps` 背景
- 定义红头、红线、文号位置

**措辞库**：
- 管理常用"起首语"（如：为了贯彻落实...）
- 管理常用"结束语"（如：特此通知）

**字段定义**：
- 为不同模板定义元数据（如：`secret_level` 密级, `host_dept` 主办部门）

#### 4.1.2 知识库服务 (Knowledge Base)

**多源管理**：
- **政策库**：上传学校章程、管理办法（PDF/Word）
- **历史文书库**：上传往年高质量公文（用于 Few-shot Learning）
- **术语库**：统一专有名词（如"双一流"、"部区合建"）

**检索逻辑**：
- 混合检索（Keyword + Vector）
- 支持按部门/年份过滤

#### 4.1.3 流程与审批 (Workflow)

**流转节点**：
```
起草 → 协作（多人修订） → 审核（部门领导） → 签发（校领导） → 归档
```

**留痕**：
- 基于 `diff-match-patch` 算法
- 记录谁在什么时间修改了哪一段文字

#### 4.1.4 归档与检索 (Archive)

**版本链**：
- 保留 `v1(草稿)` → `v2(修订)` → `v3(定稿)` 的完整快照

**结构化检索**：
- 支持组合查询（例如：查"2024年"+"教务处"+"通知"+含"人工智能"关键词的文档）

---

### 4.2 场景插件功能（以"行政公文"为例）

#### 前端交互层（参考巧文书 UI）

##### Step 1: 要素录入

**表单**：
- 输入标题、主送单位、抄送单位

**附件解析**：
- 上传上级文件图片/PDF
- OCR 提取关键要求

##### Step 2: 大纲确认

- 树形组件展示 AI 预设大纲
- 支持拖拽调整顺序、增删节点

##### Step 3: 智能撰写（核心交互）

**左栏**：
- 显示当前段落的"参考依据"
- 例如：自动关联《教学事故认定办法》第三条

**右栏**：
- 打字机效果逐段生成
- 支持"重新生成本段"或"人工微调"

##### Step 4: 格式预览

**红头套打**：
- CSS 实时渲染红头纸样式

**水印注入**：
- 草稿阶段强制添加"草稿"水印

---

## 5. 页面功能详细定义 (Functional Specifications)

### 2.1 页面一：工作台 (Dashboard)

**参考布局**：顶部 Banner + 双核心入口卡片 + 特色专区 + 任务列表

#### 2.1.1 顶部通告栏 (Banner)

- **内容**：展示一条行政风格通知，如"关于2026年春季学期公文规范化排版的最新通知"
- **样式**：淡橙色/淡蓝色背景，右侧带"查看详情"箭头

#### 2.1.2 核心入口区 (Core Cards)

并排展示两个大卡片，引导不同用户场景：

##### 📄 行政公文起草 (主推)

- **背景**：深蓝渐变
- **文案**："内置学校标准红头与审批流"
- **快捷按钮**：`[通知起草]` `[会议纪要]` `[请示报告]`
- **交互**：点击任意按钮，跳转至 Smart Writer 页面（携带参数 `type=admin`）

##### 📚 科研/教学材料

- **背景**：青色/浅蓝渐变
- **文案**："AI 辅助申报书与大纲编写"
- **快捷按钮**：`[项目申报]` `[教学大纲]` `[结题报告]`

#### 2.1.3 特色专区 (Feature Zone)

中间一行 4 个白色小卡片（Icon + Title + Desc）：

- **合规性自查**：自动检测是否违反校规
- **历史文书库**：检索往年类似文件
- **模板下载**：下载官方 Word/PDF 模板
- **AI 工具箱**：润色、降重、续写

#### 2.1.4 最近任务 (Task Table)

- **展示字段**：序号、文书名称、类型（Tag样式）、状态（草稿/审核中/已归档）、当前步骤、操作（编辑/删除）
- **数据源**：读取 `mock/task_list.json`

---

### 2.2 页面二：智能创作台 (Smart Writer) ⭐ 核心

**布局架构**：

- **左侧 (240px)**：固定侧边栏，包含 Logo、垂直步骤条 (`el-steps direction="vertical"`)
- **右侧 (自适应)**：白色大卡片内容区，根据步骤切换内容

#### 步骤 1：需求录入 (Input)

**UI参考**：Tab 切换模式

##### Tab A：上传参考文件

- 包含一个大虚线框 (`el-upload drag`)，支持拖拽
- **提示文案**："上传上级红头文件图片、会议录音稿..."

##### Tab B：粘贴/手写需求

- 多行文本框

##### 配置项 (底部)

- **业务类型**：单选 `[行政类]` `[党务类]` `[教学类]`
- **关联知识库**：下拉框 (模拟数据：《2025本科教学管理规定》, 《差旅报销标准》)
- **篇幅控制**：滑块 (Slider)，标记"短篇(500字)"、"中篇(1500字)"、"长篇(3000字)"

---

#### 步骤 2：大纲确认 (Outline)

- **左侧显示**：树形结构编辑器 (`el-tree`)
  - 支持修改节点文字
  - 支持拖拽节点顺序（演示重点：强调人工可干预）
- **交互**：点击"生成正文"按钮 → 进入 Loading 状态（提示"正在解析制度库..."） → 2秒后跳转步骤3

---

#### 步骤 3：智能撰写 (Content Generation)

**布局切换为左右分栏**：

##### 左栏 (AI 交互区 30%)

- 显示"引用依据"卡片：列出步骤1选中的知识库条款
- 显示 AI 思考过程日志："正在匹配格式..."、"正在校对错别字..."

##### 右栏 (红头预览区 70%)

- **核心组件**：`<RedHeaderDoc />` (CSS绘制的A4纸)
- **特效**：打字机效果。正文内容不是一次性出现，而是逐字输入，且页面随内容自动滚动

---

#### 步骤 4：排版与归档 (Preview & Export)

##### 工具栏

- **红头切换**：`[党委红头]` `[行政红头]` `[便函]`。点击即时切换 CSS 类名
- **盖章**：Switch 开关。开启后，右下角淡入红色 PNG 印章

##### 操作

- **`[导出 Word]`**：模拟下载
- **`[发起审批]`**：Toast 提示"已提交教务处审核"，跳转回 Dashboard

---

## 3. UI/UX 设计规范 (Design System)

### 3.1 颜色系统

| 类型 | 颜色值 | 用途 |
|------|--------|------|
| **Primary (主色)** | `#1890FF` | 按钮、选中状态、进度条 |
| **Danger (公文红)** | `#FF0000` | 仅用于红头文字、红线、印章，不可用于UI按钮以免混淆 |
| **Background (底色)** | `#F5F7FA` | 全局背景 |
| **Text (正文)** | `#303133` (主要文字)<br>`#606266` (次要文字) | 文本内容 |

### 3.2 字体规范

- **界面字体**：`PingFang SC`, `Microsoft YaHei`
- **文书内容字体** (必须严格执行)：
  - **红头大字**：`SimSun (宋体)` 或 `SimHei (黑体)`
  - **公文正文**：`FangSong (仿宋_GB2312)` —— **这是体现"专业度"的关键**

### 3.3 组件样式

- **卡片**：圆角 `8px`，阴影 `box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1)`
- **步骤条**：位于左侧 Sidebar，高度 `100%`，使用 Element Plus 默认样式但在 Active 状态下加粗

---

## 4. 数据结构模拟 (Mock Data Schema)

前端需在 `src/mock` 目录下创建以下 JSON 文件以驱动演示。

### 4.1 scenarios.json (场景定义)

```json
[
  {
    "id": "admin_notice",
    "name": "行政通知",
    "icon": "icon-notice",
    "default_kb": ["school_rule_2025"],
    "outline_template": [
      { "label": "一、背景与目的" },
      { "label": "二、主要内容" },
      { "label": "三、工作要求" }
    ]
  }
]
```

### 4.2 generation_stream.json (生成流模拟)

用于打字机效果的数据源。

```json
{
  "admin_notice": {
    "title": "关于举办2026年人工智能赋能教学改革专题培训的通知",
    "doc_number": "西大教字〔2026〕12号",
    "paragraphs": [
      "各学院、各部门：",
      "为深入贯彻落实国家教育数字化战略行动，提升我校教师数字素养...",
      "一、培训时间：2026年3月15日（周三）下午14:30。",
      "二、培训地点：综合教学楼一号报告厅。"
    ],
    "references": [
      "《教育部关于推进教育数字化转型的意见》",
      "《广西大学教师培训管理办法》"
    ]
  }
}
```

---

## 5. 开发路线图 (Roadmap for Demo)

### Phase 1: 骨架搭建 (Day 1)

- [ ] 初始化 Vue3 + Vite + Element Plus
- [ ] 搭建 Layout：左侧 Sidebar + 右侧 Main
- [ ] 完成 Dashboard 静态页面

### Phase 2: 核心组件 (Day 2)

- [ ] 开发 `<RedHeaderDoc />` 组件（CSS画红头）
- [ ] 封装 `useTypewriter` Hook（打字机逻辑）

### Phase 3: 流程串联 (Day 3)

- [ ] 实现 Writer 页面的 Step 1 (表单) → Step 2 (树) → Step 3 (打字) 的状态跳转
- [ ] 挂载 Mock 数据

### Phase 4: 细节润色 (Day 4)

- [ ] 增加 Loading 动画
- [ ] 增加印章淡入淡出效果
- [ ] 微调仿宋字体渲染效果

---

## 6. 验收标准 (Acceptance Criteria)

| 验收项 | 标准 |
|--------|------|
| ✅ **视觉验收** | 界面必须符合"巧文书"的干净风格，不能有廉价感 |
| ✅ **红头验收** | 生成的文档看起来必须像一张真实的 A4 红头文件（字体、字号、边距准确） |
| ✅ **流程验收** | 从首页点击"通知起草"到最后"盖章"，整个流程顺畅，无报错 |
| ✅ **演示验收** | 打字机生成过程流畅，没有明显的卡顿 |